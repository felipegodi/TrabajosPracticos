dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
View(dfn)
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre) %>% mutate(label_y = max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
View(dfn)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y) + 0.5 * WorldGross)
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y) + 0.5 * WorldGross)
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y) + 0.5 * total)
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross) - 0.5 * WorldGross)
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y) + 0.1 * total)
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross))
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y))
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
dfn <- subset(HollywoodMovies2013, Genre %in% c("Action","Adventure","Comedy","Drama")
& LeadStudio %in% c("Fox","Sony","Columbia","Paramount","Disney"))
dfn = dfn %>% arrange(Genre, LeadStudio)
dfn = dfn %>% group_by(Genre) %>% mutate(total = sum(WorldGross))
dfn = dfn %>% group_by(Genre) %>% mutate(label_y = cumsum(WorldGross))
dfn =dfn %>% group_by(Genre,LeadStudio) %>% mutate(label_y = total - max(label_y) + 0.1*total)
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + geom_col()
p6 = p5 + geom_text(aes(y = label_y, label=LeadStudio))
p6
p1 = ggplot(dfn, aes(x=Genre,y=WorldGross,fill=LeadStudio,label=WorldGross))
p2 = p1 + geom_bar(stat="identity")
p3 = p2 + labs(x="",
y="",
title="World Gross per genre and studio",
subtitle="(in millions of dollars)")
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + annotate("text", label="Sony", x="Action", y = 2500, hjust=0.5,vjust=0,
family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text", label="Sony", x="Action", y = 2400, hjust=0.5,vjust=0,
family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text", label="Sony", x="Action", y = 2300, hjust=0.5,vjust=0,
family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text", label="Sony", x="Action", y = 2200, hjust=0.5,vjust=0,
family="PermanentMarker-Regular",size=4,color="black")
p5
+ annotate("text",label="Columbia",x="Adventure",y=23000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p4 = p3 + scale_fill_discrete(name="") + theme_minimal() + theme(legend.position=c(0.7,0.8))
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7500,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=17000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=23000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7500,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=18000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=23000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7500,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=23000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=23000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21000, xend="Adventure", yend=20000, color="black")
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21000, xend="Adventure", yend=20000, color="black", curvature=-0.5)
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21000, xend="Adventure", yend=20000, color="black", curvature=0)
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21000, xend="Adventure", yend=20000, color="black", curvature=-0.1)
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21000, xend="Adventure", yend=21000, color="black", curvature=-0.1)
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=22000, xend="Adventure", yend=21000, color="black", curvature=-0.1)
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21800, xend="Adventure", yend=21000, color="black", curvature=-0.1)
p5
annotate("curve", x="Action", y=21800, xend="Adventure", yend=21000, color="black", curvature=-0.1,arrow = arrow(length = unit(0.03, "npc"))
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21800, xend="Adventure", yend=21000, color="black", curvature=-0.1,arrow = arrow(length = unit(0.03, "npc")))
p5
p5 = p4 + annotate("text",label="Sony",x="Action",y=2200,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Paramount",x="Action",y=7000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Fox",x="Action",y=13000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Disney",x="Action",y=19000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("text",label="Columbia",x="Adventure",y=20000,hjust=0.5,vjust=0,family="PermanentMarker-Regular",size=4,color="black") +
annotate("curve", x="Action", y=21800, xend="Adventure", yend=21000, color="black", curvature=-0.2,arrow = arrow(length = unit(0.03, "npc")))
p5
p5 + guides(fill="none")
library(rgdal)
library(dplyr)
library(ggplot2)
library(tmap)
library(broom)
library(ggpubr)
library(tidyverse)
library(shadowtext)
setwd("~/Documents/UdeSA/Maestría/Herramientas computacionales/TrabajosPracticos/TP 5")
lnd <- readOGR("data/london_sport.shp")
# Cargamos el csv con datos de crimen en Londres
crime_data <- read.csv("data/mps-recordedcrime-borough.csv",
stringsAsFactors = FALSE)
# Nos quedamos con los crimenes "Theft & Handling"
crime_theft <- crime_data[crime_data$CrimeType == "Theft & Handling", ]
# Calculamos la cantidad (suma) de thefts para cada distrito (borough) en Londres
crime_ag <- aggregate(CrimeCount ~ Borough, FUN = sum, data = crime_theft)
# Chequeamos que los nombres de los boroughs coincidan en lnd  y crime_ag, luego vemos cuáles son las que no coinciden (City of London no está en la base crime_ag)
lnd$name %in% crime_ag$Borough
lnd$name[!lnd$name %in% crime_ag$Borough]
# Mergeamos las bases de datos con un left join (nos quedamos con los datos que coinciden)
lnd@data <- left_join(lnd@data, crime_ag, by = c('name' = 'Borough'))
## ---- Mapa de thefts con ggplot ----
#Para poder usar ggplot para armar el mapa, convertimos los datos a un dataframe, usando la función tidy().
lnd_f <- broom::tidy(lnd)
#Agregamos al dataframe los nombres de los barrios
lnd$id <- row.names(lnd) # allocate an id variable to the sp data
lnd_f <- left_join(lnd_f, lnd@data) # join the data
#Hacemos una copia del df, para trabajar sobre la copia.
lnd_copy <- lnd_f
#Transformamos las variables factor y character a numéricas.
lnd_copy$piece <- as.numeric(as.factor(lnd_copy$piece))
lnd_copy$group <- as.numeric(as.factor(lnd_copy$group))
lnd_copy$id <- as.numeric(as.character(lnd_copy$id))
lnd_copy$Pop_2001 <- as.numeric(as.character(lnd_copy$Pop_2001))
lnd_copy$ons_label <- as.numeric(as.character(lnd_copy$ons_label))
#Calculamos la media de todas las variables en este nuevo df transformado:
mean_vars <- lnd_copy %>%
group_by(name) %>%
summarise_all("mean")
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1
#breaks = pretty_breaks()
)+ theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = pretty_breaks())+
theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = quantile())+
theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = quantile())+
theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = quantile(CrimeCount))+
theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = quantile(lnd_f$CrimeCount))+
theme_transparent()
View(lnd_f)
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = ) +
theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1,
breaks = pretty_breaks()) +
theme_transparent()
#breaks = pretty_breaks())
+ theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1
#breaks = pretty_breaks())
)+ theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount,breaks = pretty_breaks())) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1
#breaks = pretty_breaks())
)+ theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",
palette = "Reds",
direction= +1
#breaks = pretty_breaks())
)+ theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = pretty_breaks()) + theme_transparent(
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = pretty_breaks()) + theme_transparent(
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = pretty_breaks()) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = pretty_breaks(n = 4)) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = 4) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = 10) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = 200) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = 1) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1,breaks = 100) + theme_transparent()
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1) + theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount,breaks = 4)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1) + theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount,breaks = 4)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1) + theme_transparent()
map <- ggplot(lnd_f, aes(long, lat, group = group, fill = CrimeCount,breaks = 1)) +
geom_polygon(colour="darkgray") + coord_equal() +
geom_shadowtext(aes(label = name),                      # qué variable usa para las etiquetas
data = mean_vars,                       # datos que usa para las etiquetas
check_overlap = TRUE,                   # para que las etiquetas no se superpongan
#stat="identity", position = "identity",
size = 3,                               # tamaño
hjust = 0.5,                            # justificacion horizontal
vjust = 0.5,                            # justificacion vertical
color = "black",                        # color de la etiqueta
bg.color="white") +                     # color de fondo de la etiqueta
labs(x = "x",
y = "y",
fill = "Amount of thefts")
map + scale_fill_distiller(name="Amount of thefts by borough",palette = "Reds",direction= +1) + theme_transparent()
